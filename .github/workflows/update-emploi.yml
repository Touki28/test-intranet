name: ğŸ”„ Mise Ã  jour automatique de l'emploi du temps

on:
  schedule:
    - cron: '0 */6 * * *'  # Toutes les 6 heures
  workflow_dispatch:        # Permet de lancer manuellement

permissions:
  contents: write           # Permission d'Ã©criture sur le dÃ©pÃ´t

jobs:
  update-emploi:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ›ï¸ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ“¥ TÃ©lÃ©charger le fichier ICS
        run: |
          curl -L -o emploi.ics "https://hplanning.univ-lehavre.fr/Telechargements/ical/Edt_INFOG2.ics?version=2022.0.5.0&idICal=44AB2688C2CC0095C8BC88B7F49766AD&param=643d5b312e2e36325d2666683d3126663d31"
          
          if [ ! -s emploi.ics ]; then
            echo "âŒ Erreur: le fichier tÃ©lÃ©chargÃ© est vide"
            exit 1
          fi
          
          echo "âœ… Fichier tÃ©lÃ©chargÃ© avec succÃ¨s ($(wc -l < emploi.ics) lignes)"
      
      - name: ğŸ’¾ Commit et push si modification
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add emploi.ics
          
          if git diff --staged --quiet; then
            echo "â„¹ï¸ Aucune modification dÃ©tectÃ©e"
          else
            echo "âœ¨ Modifications dÃ©tectÃ©es, crÃ©ation du commit..."
            git commit -m "ğŸ”„ Mise Ã  jour automatique de l'emploi du temps

Fichier mis Ã  jour le $(date +'%d/%m/%Y Ã  %H:%M:%S')
Taille: $(wc -l < emploi.ics) lignes"
            
            # Configurer le remote avec le PAT pour push
            git remote set-url origin https://x-access-token:$GH_PAT@github.com/${{ github.repository }}.git
            git push origin main
            echo "âœ… Mise Ã  jour terminÃ©e avec succÃ¨s!"
          fi
